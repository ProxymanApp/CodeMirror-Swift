'use strict';(function(h){"object"==typeof exports&&"object"==typeof module?h(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],h):h(CodeMirror)})(function(h){function g(b,a,e,c){this.cm=b;this.node=a;this.options=e;this.height=c;this.cleared=!1}function p(b){var a=b.getWrapperElement(),e=window.getComputedStyle?window.getComputedStyle(a):a.currentStyle,c=parseInt(e.height),d=b.state.panels={setHeight:a.style.height,panels:[],wrapper:document.createElement("div")};
e=b.hasFocus();var k=b.getScrollInfo();a.parentNode.insertBefore(d.wrapper,a);d.wrapper.appendChild(a);b.scrollTo(k.left,k.top);e&&b.focus();b._setSize=b.setSize;null!=c&&(b.setSize=function(q,f){f||(f=d.wrapper.offsetHeight);d.setHeight=f;if("number"!=typeof f){var l=/^(\d+\.?\d*)px$/.exec(f);l?f=Number(l[1]):(d.wrapper.style.height=f,f=d.wrapper.offsetHeight)}l=f-d.panels.map(function(m){return m.node.getBoundingClientRect().height}).reduce(function(m,r){return m+r},0);b._setSize(q,l);c=f})}function n(b,
a){for(a=a.nextSibling;a;a=a.nextSibling)if(a==b.getWrapperElement())return!0;return!1}h.defineExtension("addPanel",function(b,a){a=a||{};this.state.panels||p(this);var e=this.state.panels,c=e.wrapper,d=this.getWrapperElement(),k=a.replace instanceof g&&!a.replace.cleared;a.after instanceof g&&!a.after.cleared?c.insertBefore(b,a.before.node.nextSibling):a.before instanceof g&&!a.before.cleared?c.insertBefore(b,a.before.node):k?(c.insertBefore(b,a.replace.node),a.replace.clear(!0)):"bottom"==a.position?
c.appendChild(b):"before-bottom"==a.position?c.insertBefore(b,d.nextSibling):"after-top"==a.position?c.insertBefore(b,d):c.insertBefore(b,c.firstChild);c=a&&a.height||b.offsetHeight;d=new g(this,b,a,c);e.panels.push(d);this.setSize();a.stable&&n(this,b)&&this.scrollTo(null,this.getScrollInfo().top+c);return d});g.prototype.clear=function(b){if(!this.cleared){this.cleared=!0;var a=this.cm.state.panels;a.panels.splice(a.panels.indexOf(this),1);this.cm.setSize();this.options.stable&&n(this.cm,this.node)&&
this.cm.scrollTo(null,this.cm.getScrollInfo().top-this.height);a.wrapper.removeChild(this.node);if(0==a.panels.length&&!b){b=this.cm;a=b.state.panels;b.state.panels=null;var e=b.getWrapperElement(),c=b.hasFocus(),d=b.getScrollInfo();a.wrapper.parentNode.replaceChild(e,a.wrapper);b.scrollTo(d.left,d.top);c&&b.focus();e.style.height=a.setHeight;b.setSize=b._setSize;b.setSize()}}};g.prototype.changed=function(){this.height=this.node.getBoundingClientRect().height;this.cm.setSize()}});
