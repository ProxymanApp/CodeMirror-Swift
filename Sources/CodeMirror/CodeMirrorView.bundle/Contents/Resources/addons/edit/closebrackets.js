'use strict';(function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function u(a,b){return"pairs"==b&&"string"==typeof a?a:"object"==typeof a&&null!=a[b]?a[b]:C[b]}function D(a){for(var b=0;b<a.length;b++){var c=a.charAt(b),d="'"+c+"'";x[d]||(x[d]=H(c))}}function H(a){return function(b){return I(b,a)}}function y(a){var b=a.state.closeBrackets;return!b||b.override?
b:a.getModeAt(a.getCursor()).closeBrackets||b}function v(a,b){for(var c=[],d=a.listSelections(),g=0,k=0;k<d.length;k++){var h=d[k];h.head==a.getCursor()&&(g=k);h=h.head.ch||0<b?{line:h.head.line,ch:h.head.ch+b}:{line:h.head.line-1};c.push({anchor:h,head:h})}a.setSelections(c,g)}function I(a,b){var c=y(a);if(!c||a.getOption("disableInput"))return e.Pass;var d=u(c,"pairs"),g=d.indexOf(b);if(-1==g)return e.Pass;var k=u(c,"closeBefore");c=u(c,"triples");for(var h=d.charAt(g+1)==b,E=a.listSelections(),
z=0==g%2,q,A=0;A<E.length;A++){var w=E[A],f=w.head;var m=a.getRange(f,l(f.line,f.ch+1));if(z&&!w.empty())m="surround";else if(!h&&z||m!=b)if(h&&1<f.ch&&0<=c.indexOf(b)&&a.getRange(l(f.line,f.ch-2),f)==b+b){if(2<f.ch&&/\bstring/.test(a.getTokenTypeAt(l(f.line,f.ch-2))))return e.Pass;m="addFour"}else if(h){w=0==f.ch?" ":a.getRange(l(f.line,f.ch-1),f);if(e.isWordChar(m)||w==b||e.isWordChar(w))return e.Pass;m="both"}else if(z&&(0===m.length||/\s/.test(m)||-1<k.indexOf(m)))m="both";else return e.Pass;
else m=h&&J(a,f)?"both":0<=c.indexOf(b)&&a.getRange(f,l(f.line,f.ch+3))==b+b+b?"skipThree":"skip";if(!q)q=m;else if(q!=m)return e.Pass}var t=g%2?d.charAt(g-1):b,B=g%2?b:d.charAt(g+1);a.operation(function(){if("skip"==q)v(a,1);else if("skipThree"==q)v(a,3);else if("surround"==q){for(var n=a.getSelections(),p=0;p<n.length;p++)n[p]=t+n[p]+B;a.replaceSelections(n,"around");n=a.listSelections().slice();for(p=0;p<n.length;p++){var K=n,L=p;var r=n[p];var F=0<e.cmpPos(r.anchor,r.head);r={anchor:new l(r.anchor.line,
r.anchor.ch+(F?-1:1)),head:new l(r.head.line,r.head.ch+(F?1:-1))};K[L]=r}a.setSelections(n)}else"both"==q?(a.replaceSelection(t+B,null),a.triggerElectric(t+B),v(a,-1)):"addFour"==q&&(a.replaceSelection(t+t+t+t,"before"),v(a,1))})}function G(a,b){a=a.getRange(l(b.line,b.ch-1),l(b.line,b.ch+1));return 2==a.length?a:null}function J(a,b){var c=a.getTokenAt(l(b.line,b.ch+1));return/\bstring/.test(c.type)&&c.start==b.ch&&(0==b.ch||!/\bstring/.test(a.getTokenTypeAt(b)))}var C={pairs:"()[]{}''\"\"",closeBefore:")]}'\":;>",
triples:"",explode:"[]{}"},l=e.Pos;e.defineOption("autoCloseBrackets",!1,function(a,b,c){c&&c!=e.Init&&(a.removeKeyMap(x),a.state.closeBrackets=null);b&&(D(u(b,"pairs")),a.state.closeBrackets=b,a.addKeyMap(x))});var x={Backspace:function(a){var b=y(a);if(!b||a.getOption("disableInput"))return e.Pass;var c=u(b,"pairs");b=a.listSelections();for(var d=0;d<b.length;d++){if(!b[d].empty())return e.Pass;var g=G(a,b[d].head);if(!g||0!=c.indexOf(g)%2)return e.Pass}for(d=b.length-1;0<=d;d--)c=b[d].head,a.replaceRange("",
l(c.line,c.ch-1),l(c.line,c.ch+1),"+delete")},Enter:function(a){var b=y(a);b=b&&u(b,"explode");if(!b||a.getOption("disableInput"))return e.Pass;for(var c=a.listSelections(),d=0;d<c.length;d++){if(!c[d].empty())return e.Pass;var g=G(a,c[d].head);if(!g||0!=b.indexOf(g)%2)return e.Pass}a.operation(function(){var k=a.lineSeparator()||"\n";a.replaceSelection(k+k,null);v(a,-1);c=a.listSelections();for(k=0;k<c.length;k++){var h=c[k].head.line;a.indentLine(h,null,!0);a.indentLine(h+1,null,!0)}})}};D(C.pairs+
"`")});
