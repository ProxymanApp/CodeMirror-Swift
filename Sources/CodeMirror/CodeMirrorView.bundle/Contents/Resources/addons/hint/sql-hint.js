'use strict';(function(q){"object"==typeof exports&&"object"==typeof module?q(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],q):q(CodeMirror)})(function(q){function x(a){return"[object Array]"==Object.prototype.toString.call(a)}function H(a){a=a.doc.modeOption;"sql"===a&&(a="text/x-sql");return q.resolveMode(a).keywords}function I(a){a=a.doc.modeOption;"sql"===a&&(a="text/x-sql");return q.resolveMode(a).identifierQuote||
"`"}function w(a){return"string"==typeof a?a:a.text}function B(a,b){x(b)&&(b={columns:b});b.text||(b.text=a);return b}function J(a){var b={};if(x(a))for(var c=a.length-1;0<=c;c--){var d=a[c];b[w(d).toUpperCase()]=B(w(d),d)}else if(a)for(c in a)b[c.toUpperCase()]=B(c,a[c]);return b}function C(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function D(a,b){var c=a.length;b=w(b).substr(0,c);return a.toUpperCase()===b.toUpperCase()}function v(a,b,c,d){if(x(c))for(var e=0;e<c.length;e++)D(b,
c[e])&&a.push(d(c[e]));else for(e in c)if(c.hasOwnProperty(e)){var f=c[e];f=f&&!0!==f?f.displayText?{text:f.text,displayText:f.displayText}:f.text:e;D(b,f)&&a.push(d(f))}}function K(a){"."==a.charAt(0)&&(a=a.substr(1));a=a.split(l+l);for(var b=0;b<a.length;b++)a[b]=a[b].replace(new RegExp(l,"g"),"");return a.join(l)}function y(a){for(var b=w(a).split("."),c=0;c<b.length;c++)b[c]=l+b[c].replace(new RegExp(l,"g"),l+l)+l;b=b.join(".");if("string"==typeof a)return b;a=C(a);a.text=b;return a}function L(a,
b,c,d){for(var e=!1,f=[],m=b.start,n=!0;n;)n="."==b.string.charAt(0),e=e||b.string.charAt(0)==l,m=b.start,f.unshift(K(b.string)),b=d.getTokenAt(r(a.line,b.start)),"."==b.string&&(n=!0,b=d.getTokenAt(r(a.line,b.start)));a=f.join(".");v(c,a,t,function(h){return e?y(h):h});v(c,a,p,function(h){return e?y(h):h});a=f.pop();var k=f.join("."),g=!1,u=k;t[k.toUpperCase()]||(f=k,k=E(k,d),k!==f&&(g=!0));(d=t[k.toUpperCase()])&&d.columns&&(d=d.columns);d&&v(c,a,d,function(h){var z=k;1==g&&(z=u);"string"==typeof h?
h=z+"."+h:(h=C(h),h.text=z+"."+h.text);return e?y(h):h});return m}function M(a,b){a=a.split(/\s+/);for(var c=0;c<a.length;c++)a[c]&&b(a[c].replace(/[`,;]/g,""))}function E(a,b){var c=b.doc,d=c.getValue(),e=a.toUpperCase(),f="",m="";a=[];for(var n=r(0,0),k=r(b.lastLine(),b.getLineHandle(b.lastLine()).length),g=d.indexOf(A.QUERY_DIV);-1!=g;)a.push(c.posFromIndex(g)),g=d.indexOf(A.QUERY_DIV,g+1);a.unshift(r(0,0));a.push(r(b.lastLine(),b.getLineHandle(b.lastLine()).text.length));d=null;g=b.getCursor();
for(b=0;b<a.length;b++){if((null==d||0<F(g,d))&&0>=F(g,a[b])){n=d;k=a[b];break}d=a[b]}if(n)for(c=c.getRange(n,k,!1),b=0;b<c.length&&(M(c[b],function(u){var h=u.toUpperCase();h===e&&t[f.toUpperCase()]&&(m=f);h!==A.ALIAS_KEYWORD&&(f=u)}),!m);b++);return m}var t,p,G,l,A={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},r=q.Pos,F=q.cmpPos;q.registerHelper("hint","sql",function(a,b){t=J(b&&b.tables);var c=b&&b.defaultTable;b=b&&b.disableKeywords;p=c&&t[c.toUpperCase()];G=H(a);l=I(a);c&&!p&&(p=E(c,a));p=p||[];p.columns&&
(p=p.columns);c=a.getCursor();var d=[],e=a.getTokenAt(c);e.end>c.ch&&(e.end=c.ch,e.string=e.string.slice(0,c.ch-e.start));if(e.string.match(/^[.`"'\w@][\w$#]*$/g)){var f=e.string;var m=e.start;var n=e.end}else m=n=c.ch,f="";if("."==f.charAt(0)||f.charAt(0)==l)m=L(c,e,d,a);else{var k=function(g,u){"object"===typeof g?g.className=u:g={text:g,className:u};return g};v(d,f,p,function(g){return k(g,"CodeMirror-hint-table CodeMirror-hint-default-table")});v(d,f,t,function(g){return k(g,"CodeMirror-hint-table")});
b||v(d,f,G,function(g){return k(g.toUpperCase(),"CodeMirror-hint-keyword")})}return{list:d,from:r(c.line,m),to:r(c.line,n)}})});
